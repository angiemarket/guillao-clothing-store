{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/angel/OneDrive/Pictures/Karen Sutton Hair Studio/guillao-clothing-store/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/angel/OneDrive/Pictures/Karen Sutton Hair Studio/guillao-clothing-store/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\angel\\\\OneDrive\\\\Pictures\\\\Karen Sutton Hair Studio\\\\guillao-clothing-store\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{useState}from'react';import{CardElement,useStripe,useElements}from'@stripe/react-stripe-js';import{useSelector}from'react-redux';import{selectCartTotal}from'../../store/cart/cart.selector';import{selectCurrentUser}from'../../store/user/user.selector';import{BUTTON_TYPE_CLASSES}from'../button/button.component';import{PaymentFormContainer,FormContainer,PaymentButton}from'./payment-form.styles';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ifValidCardElement=function ifValidCardElement(card){return card!==null;};var PaymentForm=function PaymentForm(){var stripe=useStripe();var elements=useElements();var amount=useSelector(selectCartTotal);var currentUser=useSelector(selectCurrentUser);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isProcessingPayment=_useState2[0],setIsProcessingPayment=_useState2[1];var paymentHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var response,client_secret,cardDetails,paymentResult;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:setIsProcessingPayment(true);_context.next=6;return fetch('/.netlify/functions/create-payment-intent',{method:'post',headers:{'Content-Type':'application/json'},body:JSON.stringify({amount:amount*100})}).then(function(res){return res.json();});case 6:response=_context.sent;client_secret=response.paymentIntent.client_secret;cardDetails=elements.getElement(CardElement);if(ifValidCardElement(cardDetails)){_context.next=11;break;}return _context.abrupt(\"return\");case 11:_context.next=13;return stripe.confirmCardPayment(client_secret,{payment_method:{card:cardDetails,billing_details:{name:currentUser?currentUser.displayName:'Guest'}}});case 13:paymentResult=_context.sent;setIsProcessingPayment(false);if(paymentResult.error){alert(paymentResult.error);}else{if(paymentResult.paymentIntent.status==='succeeded'){alert('Payment Successful');}}case 16:case\"end\":return _context.stop();}}},_callee);}));return function paymentHandler(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(PaymentFormContainer,{children:/*#__PURE__*/_jsxs(FormContainer,{onSubmit:paymentHandler,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Credit Card Payment: \"}),/*#__PURE__*/_jsx(CardElement,{}),/*#__PURE__*/_jsx(PaymentButton,{isLoading:isProcessingPayment,buttonType:BUTTON_TYPE_CLASSES.inverted,children:\"Pay now\"})]})});};export default PaymentForm;","map":{"version":3,"sources":["C:/Users/angel/OneDrive/Pictures/Karen Sutton Hair Studio/guillao-clothing-store/src/components/payment-form/payment-form.component.tsx"],"names":["useState","CardElement","useStripe","useElements","useSelector","selectCartTotal","selectCurrentUser","BUTTON_TYPE_CLASSES","PaymentFormContainer","FormContainer","PaymentButton","ifValidCardElement","card","PaymentForm","stripe","elements","amount","currentUser","isProcessingPayment","setIsProcessingPayment","paymentHandler","e","preventDefault","fetch","method","headers","body","JSON","stringify","then","res","json","response","client_secret","paymentIntent","cardDetails","getElement","confirmCardPayment","payment_method","billing_details","name","displayName","paymentResult","error","alert","status","inverted"],"mappings":"ggBAAA,OAASA,QAAT,KAAoC,OAApC,CACA,OAASC,WAAT,CAAsBC,SAAtB,CAAiCC,WAAjC,KAAoD,yBAApD,CAEA,OAASC,WAAT,KAA4B,aAA5B,CAEA,OAASC,eAAT,KAAgC,gCAAhC,CACA,OAASC,iBAAT,KAAkC,gCAAlC,CAEA,OAASC,mBAAT,KAAoC,4BAApC,CAEA,OACEC,oBADF,CAEEC,aAFF,CAGEC,aAHF,KAIO,uBAJP,C,wFAMA,GAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CACzBC,IADyB,QAEKA,CAAAA,IAAI,GAAK,IAFd,EAA3B,CAIA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACxB,GAAMC,CAAAA,MAAM,CAAGZ,SAAS,EAAxB,CACA,GAAMa,CAAAA,QAAQ,CAAGZ,WAAW,EAA5B,CACA,GAAMa,CAAAA,MAAM,CAAGZ,WAAW,CAACC,eAAD,CAA1B,CACA,GAAMY,CAAAA,WAAW,CAAGb,WAAW,CAACE,iBAAD,CAA/B,CACA,cAAsDN,QAAQ,CAAC,KAAD,CAA9D,wCAAOkB,mBAAP,eAA4BC,sBAA5B,eAEA,GAAMC,CAAAA,cAAc,0FAAG,iBAAOC,CAAP,uKACrBA,CAAC,CAACC,cAAF,GADqB,KAGjB,CAACR,MAAD,EAAW,CAACC,QAHK,kEAOrBI,sBAAsB,CAAC,IAAD,CAAtB,CAPqB,sBASEI,CAAAA,KAAK,CAAC,2CAAD,CAA8C,CACxEC,MAAM,CAAE,MADgE,CAExEC,OAAO,CAAE,CACP,eAAgB,kBADT,CAF+D,CAKxEC,IAAI,CAAEC,IAAI,CAACC,SAAL,CAAe,CAAEZ,MAAM,CAAEA,MAAM,CAAG,GAAnB,CAAf,CALkE,CAA9C,CAAL,CAMpBa,IANoB,CAMf,SAACC,GAAD,QAASA,CAAAA,GAAG,CAACC,IAAJ,EAAT,EANe,CATF,QASfC,QATe,eAkBFC,aAlBE,CAmBjBD,QAnBiB,CAkBnBE,aAlBmB,CAkBFD,aAlBE,CAqBfE,WArBe,CAqBDpB,QAAQ,CAACqB,UAAT,CAAoBnC,WAApB,CArBC,IAuBhBU,kBAAkB,CAACwB,WAAD,CAvBF,0FAyBOrB,CAAAA,MAAM,CAACuB,kBAAP,CAA0BJ,aAA1B,CAAyC,CACnEK,cAAc,CAAE,CACd1B,IAAI,CAAEuB,WADQ,CAEdI,eAAe,CAAE,CACfC,IAAI,CAAEvB,WAAW,CAAGA,WAAW,CAACwB,WAAf,CAA6B,OAD/B,CAFH,CADmD,CAAzC,CAzBP,SAyBfC,aAzBe,eAkCrBvB,sBAAsB,CAAC,KAAD,CAAtB,CAEA,GAAIuB,aAAa,CAACC,KAAlB,CAAyB,CACvBC,KAAK,CAACF,aAAa,CAACC,KAAf,CAAL,CACD,CAFD,IAEO,CACL,GAAID,aAAa,CAACR,aAAd,CAA4BW,MAA5B,GAAuC,WAA3C,CAAwD,CACtDD,KAAK,CAAC,oBAAD,CAAL,CACD,CACF,CA1CoB,uDAAH,kBAAdxB,CAAAA,cAAc,4CAApB,CA6CA,mBACE,KAAC,oBAAD,wBACE,MAAC,aAAD,EAAe,QAAQ,CAAEA,cAAzB,wBACE,6CADF,cAEE,KAAC,WAAD,IAFF,cAGE,KAAC,aAAD,EACE,SAAS,CAAEF,mBADb,CAEE,UAAU,CAAEX,mBAAmB,CAACuC,QAFlC,qBAHF,GADF,EADF,CAcD,CAlED,CAoEA,cAAejC,CAAAA,WAAf","sourcesContent":["import { useState, FormEvent } from 'react';\nimport { CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport { StripeCardElement } from '@stripe/stripe-js';\nimport { useSelector } from 'react-redux';\n\nimport { selectCartTotal } from '../../store/cart/cart.selector';\nimport { selectCurrentUser } from '../../store/user/user.selector';\n\nimport { BUTTON_TYPE_CLASSES } from '../button/button.component';\n\nimport {\n  PaymentFormContainer,\n  FormContainer,\n  PaymentButton,\n} from './payment-form.styles';\n\nconst ifValidCardElement = (\n  card: StripeCardElement | null\n): card is StripeCardElement => card !== null;\n\nconst PaymentForm = () => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const amount = useSelector(selectCartTotal);\n  const currentUser = useSelector(selectCurrentUser);\n  const [isProcessingPayment, setIsProcessingPayment] = useState(false);\n\n  const paymentHandler = async (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    setIsProcessingPayment(true);\n\n    const response = await fetch('/.netlify/functions/create-payment-intent', {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ amount: amount * 100 }),\n    }).then((res) => res.json());\n\n    const {\n      paymentIntent: { client_secret },\n    } = response;\n\n    const cardDetails = elements.getElement(CardElement);\n\n    if (!ifValidCardElement(cardDetails)) return;\n\n    const paymentResult = await stripe.confirmCardPayment(client_secret, {\n      payment_method: {\n        card: cardDetails,\n        billing_details: {\n          name: currentUser ? currentUser.displayName : 'Guest',\n        },\n      },\n    });\n\n    setIsProcessingPayment(false);\n\n    if (paymentResult.error) {\n      alert(paymentResult.error);\n    } else {\n      if (paymentResult.paymentIntent.status === 'succeeded') {\n        alert('Payment Successful');\n      }\n    }\n  };\n\n  return (\n    <PaymentFormContainer>\n      <FormContainer onSubmit={paymentHandler}>\n        <h2>Credit Card Payment: </h2>\n        <CardElement />\n        <PaymentButton\n          isLoading={isProcessingPayment}\n          buttonType={BUTTON_TYPE_CLASSES.inverted}\n        >\n          Pay now\n        </PaymentButton>\n      </FormContainer>\n    </PaymentFormContainer>\n  );\n};\n\nexport default PaymentForm;\n"]},"metadata":{},"sourceType":"module"}